<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="color-scheme" content="light dark"> <!-- Respects user's system theme preference -->
  <title>Generate Markdown from GitHub Repo - repo.md</title>
  <meta name="description" content="Instantly convert any GitHub repository into AI-friendly markdown. Perfect for ChatGPT, Claude, and clear project documentation. Try repo.md now!">
  <link rel="canonical" href="https://repo-md.com/" />
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "repo.md",
    "operatingSystem": "Web",
    "applicationCategory": "DeveloperTool",
    "description": "Generate Markdown documentation from GitHub repositories.",
    "url": "https://repo-md.com",
    "offers": {
      "@type": "Offer",
      "price": "0"
    }
  }
  </script>
  <link rel="icon" type="image/png" href="assets/imgs/repo-md.png">
  <link rel="stylesheet" href="styles.css">
<style>
  /* Loading spinner */
  .spinner {
    width: 40px;
    height: 40px;
    margin: 0 auto 20px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #3498db;
    border-radius: 50%;
    animation: spin 1.5s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .loading {
    text-align: center;
    padding: 2rem;
    background: #f8f9fa;
    border-radius: 8px;
    margin: 1rem 0;
    transition: all 0.3s ease;
  }

  .loading-text {
    font-size: 1.1rem;
    margin-bottom: 1rem;
    color: #333;
  }

  .progress-container {
    width: 100%;
    height: 8px;
    background: #e9ecef;
    border-radius: 4px;
    margin: 1rem 0;
    overflow: hidden;
  }

  .progress-bar {
    height: 100%;
    width: 0%;
    background: #3498db;
    border-radius: 4px;
    transition: width 0.3s ease;
  }

  .status-message {
    font-size: 0.9rem;
    color: #6c757d;
    font-style: italic;
  }
</style>
</head>
<body>
  <header class="header">
    <a href="/" style="text-decoration: none; color: inherit;"><h1>repo.md</h1></a>
    <nav class="main-nav">
      <a href="/how-it-works.html">How It Works</a>
      <a href="/sponsor.html">Sponsor</a>
    </nav>
  </header>

  <div class="hero">
    <img src="assets/imgs/repo-md.png" alt="repo.md logo" id="hero-logo">
    <div class="taglines">
      <h1>Generate Markdown from GitHub Repos Instantly</h1>
      <p>Repo.md converts GitHub repositories into AI-friendly markdown, perfect for any LLM, so you can copy and conversate on the go!</p>
    </div>
    <form id="repoForm" onsubmit="return false;">
      <input type="url" id="github_url" placeholder="https://github.com/owner/repo" required>
      <button type="button" id="submitBtn">Generate</button>
    </form>
  </div>

  <div class="container">
    <div id="loading" class="loading" style="display:none;">
      <div class="loading-text">Initializing repository scan...</div>
      <div class="progress-container">
        <div class="progress-bar"></div>
      </div>
      <div class="status-message">This may take a moment for larger repositories</div>
    </div>

    <div id="error" class="error" style="display:none;">
    </div>

    <div id="resultContainer">
      <div id="welcome" class="result">
        <pre><code id="welcome-preview"># Welcome to repo.md! üëã

This preview area will show your repository's contents in a format perfect for AI conversations.

For example:

```python
# Example of what you might see:
def hello_world():
    print("Hello from your repository!")
```

## What you'll get:
- üìÅ File structure
- üìù Code contents
- üîç Easy to read format
- ü§ñ AI-friendly markdown

Paste a GitHub repository URL above to get started!</code></pre>
      </div>

      <div class="result-actions" style="display:none;">
        <button id="copyBtn" class="action-btn">Copy to Clipboard</button>
        <button id="downloadBtn" class="action-btn">Download .md</button>
      </div>
      <div id="result" style="display:none;">
        <pre><code id="markdown"></code></pre>
      </div>
    </div>
  </div>

  <footer class="footer">
    <p>Powered by Go WASM &amp; GitHub API. Inspired by GitHub.</p>
  </footer>
<!-- All script logic related to WASM will be here -->
<script>
    const worker = new Worker('wasm-worker.js'); // Path relative to index.html in dist/
    
    // Initialize WASM as soon as the worker is created
    console.log('Sending initWasm message to worker');
    worker.postMessage({ type: 'initWasm' });

    // Fun loading messages with tech jargon
    const loadingMessages = [
      'Initializing quantum repository scanner...',
      'Calibrating neural networks...',
      'Brewing coffee for the dev team...',
      'Herding code cats...',
      'Compiling markdown particles...',
      'Initializing the flux capacitor...',
      'Warming up the GPUs...',
      'Polishing the bits...',
      'Downloading more RAM...',
      'Training the AI hamsters...',
      'Defragging the database...',
      'Aligning the code prisms...',
      'Booting up the mainframe...',
      'Initializing hyperdrive...',
      'Charging the laser beams...',
      'Consulting the documentation...',
      'Reticulating splines...',
      'Politely asking the server...',
      'Reversing the polarity...',
      'Engaging warp drive...',
      'Initializing the hyperdrive...',
      'Bending the space-time continuum...',
      'Asking ChatGPT for help...',
      'Counting to infinity...',
      'Dividing by zero...'
    ];
    
    let currentMessageIndex = 0;
    let messageInterval;
    let progressInterval; // Keep this accessible

      // Update loading state UI
    function updateLoadingState(stage, progress) {
      const loadingText = document.querySelector('.loading-text');
      const progressBar = document.querySelector('.progress-bar');
      const statusMessage = document.querySelector('.status-message');
      
      if (loadingText && loadingMessages.length > 0) { // Check length to prevent error if array is empty
        loadingText.textContent = loadingMessages[currentMessageIndex];
        currentMessageIndex = (currentMessageIndex + 1) % loadingMessages.length;
      }
      
      if (progressBar) progressBar.style.width = `${progress || 0}%`;
      if (statusMessage) {
        statusMessage.textContent = progress < 100 ? 
          'This may take a moment for larger repositories' : 
          'Almost there...';
      }
    }

    function showUIMessage(elementId, message, isError = false) {
        const el = document.getElementById(elementId);
        if (!el) return;
        el.innerHTML = message;
        el.style.display = 'block';
        if (isError) {
             console.error(message);
        }
    }

    function resetUIForNewRequest() {
        document.getElementById('loading').style.display = 'block';
        document.getElementById('welcome').style.display = 'none';
        document.getElementById('result').style.display = 'none';
        document.getElementById('error').style.display = 'none';
        document.querySelector('.result-actions').style.display = 'none';
        document.getElementById('markdown').textContent = ''; // Clear previous results
    }

    function enableSubmitButton() {
        console.log('enableSubmitButton called');
        const submitButton = document.getElementById('submitBtn');
        if (submitButton) {
            console.log('Found submitBtn, current disabled state:', submitButton.disabled);
            submitButton.disabled = false;
            submitButton.innerHTML = 'Generate';
            console.log('Button enabled, new state:', submitButton.disabled);
            
            // Force a redraw of the button
            submitButton.style.opacity = '0.99';
            setTimeout(() => {
                submitButton.style.opacity = '1';
                console.log('Button opacity reset, final disabled state:', submitButton.disabled);
            }, 10);
        } else {
            console.error('Submit button not found in DOM!');
        }
    }
    
    function handleWorkerError(errorMessage, details = '') {
        console.error('Worker Error:', errorMessage, details);
        clearInterval(progressInterval);
        clearInterval(messageInterval);
        document.getElementById('loading').style.display = 'none';
        enableSubmitButton();
        document.getElementById('welcome').style.display = 'none'; // Hide welcome
        showUIMessage('error', `<strong>Error:</strong> ${errorMessage}<br><small>${details}</small>`, true);
    }

    worker.onmessage = (event) => {
        const { type, result, error, message } = event.data;

        if (type === 'wasmReady') {
            console.log("WASM is ready in worker.");
            // Just enable the button, don't show loading yet
            enableSubmitButton(); // Enable button once WASM is ready
        } else if (type === 'wasmError') {
            handleWorkerError('WASM Initialization Failed.', error);
        } else if (type === 'markdownResult') {
            clearInterval(progressInterval);
            clearInterval(messageInterval);
            try {
                const data = JSON.parse(result); // Result from Go WASM callback
                if (data.markdown.startsWith("Error:")) { // Check if Go itself sent an error string
                    handleWorkerError(data.markdown, `Repo: ${data.repo_name}`);
                    return;
                }

                updateLoadingState(null, 100);
                
                setTimeout(() => {
                    document.getElementById('markdown').textContent = data.markdown;
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('welcome').style.display = 'none';
                    document.getElementById('result').style.display = 'block';
                    document.querySelector('.result-actions').style.display = 'flex'; // Use flex for display
                    enableSubmitButton();
                    document.getElementById('resultContainer').scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 300);
                
            } catch (parseError) {
                handleWorkerError('Failed to parse result from WASM.', `Details: ${parseError.message}. Raw: ${result}`);
            }
        } else if (type === 'error') { // General error from worker logic
             handleWorkerError(message || 'An unexpected error occurred in the worker.', error);
        }
    };
    
    // Hide loading initially - only show when user clicks Generate
    document.getElementById('loading').style.display = 'none';
    const initialSubmitButton = document.getElementById('submitBtn');
    if (initialSubmitButton) initialSubmitButton.disabled = true; // Disable until WASM ready


    document.getElementById('submitBtn').addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const form = document.getElementById('repoForm');
        const submitButton = this; // `this` is the button
        const urlInput = document.getElementById('github_url');
        const url = urlInput.value;
        
        if (!form.checkValidity() || !url) {
          urlInput.reportValidity(); // Show validation message on input
          return;
        }
        
        submitButton.disabled = true;
        submitButton.innerHTML = 'Working...';
        
        resetUIForNewRequest();
        updateLoadingState('init', 5); // Initial visual progress
        
        // Start loading messages cycle
        currentMessageIndex = 0; // Reset message index
        messageInterval = setInterval(() => {
          updateLoadingState(); // Will cycle through messages
        }, 2000);
        
        // Simulate progress updates
        progressInterval = setInterval(() => {
          const progressBar = document.querySelector('.progress-bar');
          if (progressBar) {
            const currentWidth = parseFloat(progressBar.style.width || '0');
            if (currentWidth < 90) {
              const increment = Math.random() * 5 + 2; // Slightly faster perceived progress
              updateLoadingState(null, Math.min(currentWidth + increment, 90));
            }
          }
        }, 500); // Update progress faster

        worker.postMessage({ type: 'generateMarkdown', url: url });
    });

    // Failsafe for form submission if button type is "submit" (it's "button" now)
    document.getElementById('repoForm').addEventListener('submit', function(e) {
        e.preventDefault();
        // Trigger click on the actual button to ensure consistent logic
        document.getElementById('submitBtn').click();
    });
    // Copy and Download button listeners
    document.getElementById('copyBtn').addEventListener('click', function() {
      const markdownText = document.getElementById('markdown').textContent;
      navigator.clipboard.writeText(markdownText).then(() => {
        alert('Copied to clipboard!');
      }, (err) => {
        console.error('Could not copy text: ', err);
        alert('Failed to copy. Please try manually.');
      });
    });

    document.getElementById('downloadBtn').addEventListener('click', function() {
      const markdownText = document.getElementById('markdown').textContent;
      const repoName = document.getElementById('github_url').value.split('/').pop() || 'repository';
      const blob = new Blob([markdownText], { type: 'text/markdown;charset=utf-8' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${repoName}.md`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);
    });
    
    // Direct fix to ensure button becomes enabled
    setTimeout(() => {
      console.log('Force-enabling submit button');
      const submitBtn = document.getElementById('submitBtn');
      if (submitBtn) {
        submitBtn.disabled = false;
        console.log('Button force-enabled');
      }
    }, 1000);
  </script>
</body>
</html>